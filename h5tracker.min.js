!function(e,n){function t(e){if(!e||"string"!=typeof e)return e;var n=v[e];return n?n:(n=e.indexOf("-")<0&&e.indexOf("_")<0?e:e.replace(/[-_]+([a-z])/gi,function(e,n){return n.toUpperCase()}),v[e]=n,n)}function r(){function e(e,n){return i.push({event:e,fn:n}),o}function n(e,n){return i=i.filter(function(t){return!(t.event===e&&t.fn===n)}),o}function t(t,r){function i(){n(t,i),r.apply(o,arguments)}return e(t,i),o}function r(e){var n=[].slice.call(arguments,1);return i.filter(function(n){return n.event===e}).forEach(function(e){e.fn.apply(o,n)}),o}var o={},i=[];return o.on=e,o.off=n,o.once=t,o.emit=r,o}function o(e,n){return e.replace(/#\{(.*?)\}/g,function(e,t){return n&&t in n?n[t]:""})}function i(e,n,r){var o=function(i,a){var s,c;if("function"==typeof i)return c=i["-jsets-params"],c||(c=[],String(i).replace(/\(\s*([^()]+?)\s*\)/,function(e,n){c=n.split(/\s*,\s*/)}),i["-jsets-params"]=c),o(c,i);if("string"==typeof i||"number"==typeof i)return i=r?t(i):i,"function"==typeof a?(a.call(e,n(i)),e):n(i);if("object"==typeof i){if(i instanceof Array)return"function"==typeof a?(s=[],i.forEach(function(e){s.push(n(r?t(e):e))}),a.apply(e,s),e):(s={},i.forEach(function(e){s[e]=n(r?t(e):e)}),s);var u;if("function"==typeof a){s=[];for(u in i)s.push(n(r?t(u):u)||i[u]);return e}s={};for(u in i)s[u]=n(r?t(u):u)||i[u];return s}};return o}function a(e,n,t,r,i){function a(){if(r[y]!==S&&(p=null),!p)try{p=JSON.parse(r[h]||"[]")}catch(e){p=[]}}function s(){r[y]=g(),r[h]=JSON.stringify(p)}function c(e){a();var n=g(),t=Date.now();return p.push({id:n,birthday:t,expires:i,data:e}),s(),n}function u(){return a(),p.slice()}function f(){a();var e=0,n=Date.now();if(null!==b){if(!(n>b))return e;b=null}return p=p.filter(function(t){var r=t.birthday+1e3*t.expires;return n>r?(e++,!1):(b=null!==b?Math.min(b,r):r,!0)}),s(),e}function l(e){a(),p=p.filter(function(n){return e===n.id?(n.birthday+n.expires===b&&(b=null),!1):!0}),s()}r=r||localStorage,i=i||864e3;var p,d={},v={name:t,app:e,tracker:n},y=o(m.storageListTS,v),h=o(m.storageList,v),S=null,b=null;return d.push=c,d.toArray=u,d.clean=f,d.remove=l,d}function s(n,t){function r(e){return f.push(e)}function o(e){var n=[];return Object.keys(e).forEach(function(t){null!==e[t]&&n.push(encodeURIComponent(t)+"="+encodeURIComponent(e[t]))}),n.join("&")}function i(e,n,t){u.push({accept:n,acceptStyle:t,query:o(e)});s()}function s(){f.clean(),u.clean();var n=u.toArray().pop();if(n){var t=e.createElement("img");t.onload=function(){u.remove(n.id),delete c[n.id],setTimeout(function(){s()},1e3)};var r,o=n.data.accept.match(/^([^?]+)(?:\?(.*))?$/),i=o[0],a=o[1];r="path"===n.data.acceptStyle?i+(/\/$/.test(i)?"":"/")+n.data.query.replace(/[&=]/g,"/")+(a?"?"+a:""):i+"?"+n.data.query+(a?"&"+a:""),t.src=r,c[n.id]=t}}var c={},u=a(n,t,"send"),f=a(n,t,"log");return c.log=r,c.send=i,c.scan=s,c}function c(e,n,r){return function(o,i){if("string"==typeof o||"number"==typeof o)n(r?t(o):o,i);else if("object"==typeof o)if(o instanceof Array)o.forEach(function(e,t){n(t,e)});else for(var a in o)n(r?t(a):a,o[a]);return e}}function u(n){function t(){sessionStorage[m.sessionId]&&s.emit("destroySession");var e=Date.now();sessionStorage[m.sessionId]=g(),sessionStorage[m.sessionBirthday]=e,sessionStorage[m.sessionLiveTime]=e,s.emit("createSession")}function o(){sessionStorage[m.sessionId]&&(delete sessionStorage[m.sessionId],delete sessionStorage[m.sessionBirthday],delete sessionStorage[m.sessionLiveTime],s.emit("destroySession"))}function a(){if(!u){Date.now();u=setTimeout(function(){Date.now()-sessionStorage[m.liveTime]>=1e3*n?t():sessionStorage[m.sessionLiveTime]=liveTime,u=null},1e3)}}n=n||30;var s=r(),c={id:m.sessionId,birthday:m.sessionBirthday,liveTime:m.sessionLiveTime};s.get=i(s,function(e){return sessionStorage[c[e]]},!0),s.createSession=t,s.destroySession=o,sessionStorage[m.sessionId]||t();var u;return["keydown","input","keyup","click","contextmenu","mousemove","touchstart","touchend","touchmove"].forEach(function(n){e.addEventListener(n,a,!1)}),s}function f(e,n){function t(e){if(!f)return void v.push({name:"send",data:e});if(!d.accept)return void console.error("options.accept is undefined.");var n={};if(d.data&&Object.keys(d.data).forEach(function(e){n[e]=d.data[e]}),Object.keys(p).forEach(function(e){n[e]=p[e]}),Object.keys(e).forEach(function(t){n[t]=e[t]}),d.event){var t=d.event.send;"function"==typeof t&&t.call(u,n)}u.emit("send",n),l.send(n,d.accept,d.acceptStyle)}function o(e){if(!f)return void v.push({name:"log",data:e});if("string"==typeof e&&(e={message:e,level:"debug"}),!e.level)return void console.error("log level is undefined.");var n={};if(Object.keys(e).forEach(function(t){n[t]=e[t]}),d.event){var t=d.event.log;"function"==typeof t&&t.call(u,n)}u.emit("log",n),l.log(n)}function a(e){return f?void console.error("Cannot duplicate create tracker."):e?(f=!0,d=e,v.forEach(function(e){u[e.name](e.data)}),void(v=null)):void console.error('Parameter "opts" cannot be empty.')}var u=r();u.name=n;var f,l=s(e,n),p={};u.set=c(u,function(e,n){p[e]=n},!0),u.get=i(u,function(e){return p[e]},!0);var d,v=[];return u.send=t,u.log=o,["debug","info","warn","error","fatal"].forEach(function(e){u[e]=function(n){o({level:e,message:n})}}),u.create=a,u}function l(e){function n(){}function t(n){if("string"!=typeof n)return void console.error('Parameter "line" is not a string type.');var t=n.match(/^(?:([\w$_]+)\.)?(\w+)$/);if(!t)return void console.error('Parameter "line" is invalid format.');var r=t[1],i=t[2],a=[].slice.call(arguments,1);if(r){var s=y[r];if(s||(s=y[r]=f(e,r),s.set({user:o})),"function"==typeof s[i])return s[i].apply(s,a);console.error('Tracker method "%s" is invalid.',i)}else{if("function"==typeof h[i])return h[i].apply(h,a);console.error('App method "%s" is invalid.',i)}}console.log("createApp() appName: %s",e);var o=localStorage[m.userId];o||(o=localStorage[m.userId]=g());var i=f("main");i.set({user:o}),i.createEmitter=r,i.createStorage=s,i.createStorageList=a,i.createTracker=f,i.newGuid=g,i.storageKeys=m,i.createApp=l,i.createSessionManager=u,y[i.name]=i;var c=u();c.on("createSession",function(){i.emit("createSession")}),c.on("destroySession",function(){i.emit("destroySession")});return i.config=n,i.cmd=t,i}var p=n.h5tObjectName||"h5t",d=n[p];if(!d||!d.defined){var v={},m=function(){var e="h5t@";return{userId:e+"global/userId",scanTime:e+"global/scanTime",sessionId:e+"global/sessionId",sessionBirthday:e+"global/sessionBirthday",sessionLiveTime:e+"global/sessionLiveTime",storageList:e+"storageList/#{app}/#{tracker}/#{name}",storageListTS:e+"storageList/#{app}/#{tracker}/#{name}/ts"}}(),g=function(){var e=parseInt(36*Math.random());return function(){return Date.now().toString(36)+(e++%36).toString(36)+Math.random().toString(36).slice(2,4)}}(),y={},h=l(p),S=function(){h.cmd.apply(h,arguments)};if(S.app=h,S.defined=!0,d){var b=[].concat(d.p||[],d.q||[]);d.p=d.q=null,S.p=S.q={push:function(e){S.apply(S,e)}},b.forEach(function(e){S.apply(S,e)})}n[p]=S}}(document,window);