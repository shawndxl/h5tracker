!function(e,n){function t(e){if(!e||"string"!=typeof e)return e;var n=h[e];return n?n:(n=e.indexOf("-")<0&&e.indexOf("_")<0?e:e.replace(/[-_]+([a-z])/gi,function(e,n){return n.toUpperCase()}),h[e]=n,n)}function r(e,n,r){var i=function(o,s){var a,c;if("function"==typeof o)return c=o["-jsets-params"],c||(c=[],String(o).replace(/\(\s*([^()]+?)\s*\)/,function(e,n){c=n.split(/\s*,\s*/)}),o["-jsets-params"]=c),i(c,o);if("string"==typeof o||"number"==typeof o)return o=r?t(o):o,"function"==typeof s?(s.call(e,n(o)),e):n(o);if("object"==typeof o){if(o instanceof Array)return"function"==typeof s?(a=[],o.forEach(function(e){a.push(n(r?t(e):e))}),s.apply(e,a),e):(a={},o.forEach(function(e){a[e]=n(r?t(e):e)}),a);var u;if("function"==typeof s){a=[];for(u in o)a.push(n(r?t(u):u)||o[u]);return e}a={};for(u in o)a[u]=n(r?t(u):u)||o[u];return a}};return i}function i(e,n){return e.replace(/#\{(.*?)\}/g,function(e,t){return n&&t in n?n[t]:""})}function o(e,n,t,o,s,a){function c(){if(o[b]!==q&&(y=null),!y)try{y=JSON.parse(o[E]||"[]"),q=o[b]}catch(e){y=[]}}function u(){o[b]=m(),o[E]=JSON.stringify(y)}function f(e){c();for(var n=m(),t=Date.now();y.length>=a;)y.shift();return y.push({id:n,birthday:t,expires:s,tried:0,data:e}),u(),n}function l(){return c(),y.slice()}function d(){c();var e=0,n=Date.now();if(null!==I){if(!(n>I))return e;I=null}return y=y.filter(function(t){var r=t.birthday+1e3*t.expires;return n>r?(e++,!1):(I=null!==I?Math.min(I,r):r,!0)}),u(),e}function p(e){c(),y=y.filter(function(n){return e===n.id?(n.birthday+1e3*n.expires===I&&(I=null),!1):!0}),u()}function v(e,n){var t=h.get(e);if(t)return Object.keys(n).forEach(function(e){t[e]=n[e]}),u(),!0}o=o||localStorage,s=s||864e3,a=a||1e3;var y,h={},S={name:t,app:e,tracker:n},b=i(g.storageListTS,S),E=i(g.storageList,S),q=null,I=null;return h.push=f,h.toArray=l,h.clean=d,h.remove=p,h.update=v,h.get=r(h,function(e){c();var n;return y.some(function(t){return e===t.id?(n=t,t):void 0}),n},!0),h}function s(){function e(e,n){return o.push({event:e,fn:n}),i}function n(e,n){return o=o.filter(function(t){return!(t.event===e&&t.fn===n)}),i}function t(t,r){function o(){n(t,o),r.apply(i,arguments)}return e(t,o),i}function r(e){var n=[].slice.call(arguments,1);return o.filter(function(n){return n.event===e}).forEach(function(e){e.fn.apply(i,n)}),i}var i={},o=[];return i.on=e,i.off=n,i.once=t,i.emit=r,i}function a(){function n(a){a=a||0,r&&clearTimeout(r),r=setTimeout(function(){if(r=null,t=[],Object.keys(localStorage).forEach(function(e){var n=e.match(/^h5t@storageList\/(\w+)\/(\w+)\/send$/);if(n){var r=n[1],i=n[2],a=s[[r,i]];a||(s[[r,i]]=a=o(r,i,"send"));var c=a.toArray();c.forEach(function(e){e.storageDict=[r,i].toString()}),t=t.concat(c)}}),!(t.length<=0)){t.sort(function(e,n){return e.tried===n.tried?n.birthday-e.birthday:e.tried-n.tried});var a=t.shift();if(s[a.storageDict].update(a.id,{tried:(a.tried||0)+1}),!a.data.accept)return void console.error("accept is undefined.");var c=e.createElement("img");c.onload=function(){s[a.storageDict].remove(a.id),delete i[a.id],n(1e3)},c.onerror=function(){delete i[a.id],n(3e5)};var u,f=a.data.accept.match(/^([^?]+)(?:\?(.*))?$/),l=f[1],d=f[2];u="path"===a.data.acceptStyle?l+(/\/$/.test(l)?"":"/")+a.data.query.replace(/[&=]/g,"/")+(d?"?"+d:""):l+"?"+a.data.query+(d?"&"+d:""),c.src=u,i[a.id]=c}},a)}var t,r,i={},s={};return i.scan=n,i}function c(e){var n=[];return Object.keys(e).forEach(function(t){null!==e[t]&&void 0!==e[t]&&n.push(encodeURIComponent(t)+"="+encodeURIComponent(e[t]))}),n.join("&")}function u(e,n){function t(e){return u.clean(),u.push(e)}function r(e,n,t){a.clean();var r=a.push({accept:n,acceptStyle:t,query:c(e)});return S.scan(),r}var i=s(),a=o(e,n,"send"),u=o(e,n,"log");return S.scan(),i.log=t,i.send=r,i}function f(e,n,r){return function(i,o){if("string"==typeof i||"number"==typeof i)n(r?t(i):i,o);else if("object"==typeof i)if(i instanceof Array)i.forEach(function(e,t){n(t,e)});else for(var s in i)n(r?t(s):s,i[s]);return e}}function l(n){function t(){a[g.sessionId]&&c.emit("destroySession");var e=Date.now();a[g.sessionId]=m(),null===a[g.sessionSeq]||isNaN(a[g.sessionSeq])?a[g.sessionSeq]=0:a[g.sessionSeq]=parseInt(a[g.sessionSeq])+1,a[g.sessionBirthday]=e,a[g.sessionLiveTime]=e,c.emit("createSession")}function i(){a[g.sessionId]&&(delete a[g.sessionId],delete a[g.sessionBirthday],delete a[g.sessionLiveTime],c.emit("destroySession"))}function o(e){var r=Date.now();r-a[g.sessionLiveTime]>=1e3*n?t():setTimeout(function(){a[g.sessionLiveTime]=r})}var a=sessionStorage;n=n||30;var c=s(),u={sid:g.sessionId,seq:g.sessionSeq,birthday:g.sessionBirthday,liveTime:g.sessionLiveTime};return c.get=r(c,function(e){return"undefined"==typeof a[g.sessionId]&&t(),a[u[e]]},!0),c.createSession=t,c.destroySession=i,a[g.sessionId]||t(),["keydown","input","keyup","click","contextmenu","mousemove","touchstart","touchend","touchmove"].forEach(function(n){e.addEventListener(n,o,!1)}),c}function d(e,n){function t(e){if(!c)return void v.push({name:"send",data:e});var n={rid:m()};if(p.data&&Object.keys(p.data).forEach(function(e){n[e]=p.data[e]}),Object.keys(d).forEach(function(e){n[e]=d[e]}),"string"==typeof e&&(e={ht:e}),Object.keys(e).forEach(function(t){n[t]=e[t]}),p.event){var t=p.event.send;"function"==typeof t&&t.call(a,n)}a.emit("send",n),l.send(n,p.accept,p.acceptStyle)}function i(e){if("string"==typeof e&&(e={message:e,level:"debug"}),!c)return void v.push({name:"log",data:e});var n={};if(Object.keys(e).forEach(function(t){n[t]=e[t]}),p.event){var t=p.event.log;"function"==typeof t&&t.call(a,n)}a.emit("log",n),l.log(n)}function o(e){c=!0,p=e,v.forEach(function(e){a[e.name](e.data)}),v=null}var a=s();a.name=n;var c,l=u(e,n),d={};a.set=f(a,function(e,n){d[e]=n},!0),a.get=r(a,function(e){return d[e]},!0);var p,v=[];return a.send=t,a.log=i,["debug","info","warn","error","fatal"].forEach(function(e){a[e]=function(n){i({level:e,message:n})}}),a.create=o,a}function p(e,n){function t(n){var t,s=n.match(/^(?:([\w$_]+)\.)?(\w+)$/),a=s[1],c=s[2],u=[].slice.call(arguments,1);return a?(t=b[a],t||(t=b[a]=d(e,a))):t=i,"function"==typeof t[c]?("send"===c&&t.set({uid:r,sid:o.get("sid"),seq:o.get("seq"),time:(Date.now()-o.get("birthday")).toString(36)}),t[c].apply(t,u)):void console.error('Tracker method "%s" is invalid.',c)}e=e||"h5t";var r=localStorage[g.userId];r||(r=localStorage[g.userId]=m());var i=d(e,e);b[e]=i;var o=l(n);return o.on("createSession",function(){Object.keys(b).forEach(function(e){b[e].emit("createSession")})}),o.on("destroySession",function(){Object.keys(b).forEach(function(e){b[e].emit("destroySession")})}),i.cmd=t,i}var v=n.h5tObjectName||"h5t",y=n[v];if(!y||!y.defined){n.localStorage||(n.localStorage={}),n.sessionStorage||(n.sessionStorage={});var h={},g=function(){var e="h5t@";return{userId:e+"global/userId",scanTime:e+"global/scanTime",sessionId:e+"global/sessionId",sessionSeq:e+"global/sessionSeq",sessionBirthday:e+"global/sessionBirthday",sessionLiveTime:e+"global/sessionLiveTime",storageList:e+"storageList/#{app}/#{tracker}/#{name}",storageListTS:e+"storageList/#{app}/#{tracker}/#{name}/ts"}}(),m=function(){var e=parseInt(36*Math.random());return function(){return Date.now().toString(36)+(e++%36).toString(36)+Math.random().toString(36).slice(2,4)}}(),S=a(),b={},E=p(v),q=function(){E.cmd.apply(E,arguments)};if(q.app=E,q.defined=!0,y){var I=[].concat(y.p||[],y.q||[]);y.p=y.q=null,q.p=q.q={push:function(e){q.apply(q,e)}},I.forEach(function(e){q.apply(q,e)})}n[v]=q}}(document,window);