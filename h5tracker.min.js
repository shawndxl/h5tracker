!function(e,n){function t(e){if(!e||"string"!=typeof e)return e;var n=g[e];return n?n:(n=e.indexOf("-")<0&&e.indexOf("_")<0?e:e.replace(/[-_]+([a-z])/gi,function(e,n){return n.toUpperCase()}),g[e]=n,n)}function r(e,n,r){var o=function(i,a){var s,c;if("function"==typeof i)return c=i["-jsets-params"],c||(c=[],String(i).replace(/\(\s*([^()]+?)\s*\)/,function(e,n){c=n.split(/\s*,\s*/)}),i["-jsets-params"]=c),o(c,i);if("string"==typeof i||"number"==typeof i)return i=r?t(i):i,"function"==typeof a?(a.call(e,n(i)),e):n(i);if("object"==typeof i){if(i instanceof Array)return"function"==typeof a?(s=[],i.forEach(function(e){s.push(n(r?t(e):e))}),a.apply(e,s),e):(s={},i.forEach(function(e){s[e]=n(r?t(e):e)}),s);var u;if("function"==typeof a){s=[];for(u in i)s.push(n(r?t(u):u)||i[u]);return e}s={};for(u in i)s[u]=n(r?t(u):u)||i[u];return s}};return o}function o(e,n){return e.replace(/#\{(.*?)\}/g,function(e,t){return n&&t in n?n[t]:""})}function i(e,n,t,i,a,s){function c(){if(i[b]!==T&&(g=null),!g)try{g=JSON.parse(i[E]||"[]")}catch(e){g=[]}}function u(){i[b]=m(),i[E]=JSON.stringify(g)}function f(e){c();for(var n=m(),t=Date.now();g.length>=s;)g.shift();return g.push({id:n,birthday:t,expires:a,tried:0,data:e}),u(),n}function l(){return c(),g.slice()}function d(){c();var e=0,n=Date.now();if(null!==k){if(!(n>k))return e;k=null}return g=g.filter(function(t){var r=t.birthday+1e3*t.expires;return n>r?(e++,!1):(k=null!==k?Math.min(k,r):r,!0)}),u(),e}function p(e){c(),g=g.filter(function(n){return e===n.id?(n.birthday+n.expires===k&&(k=null),!1):!0}),u()}function v(e,n){var t=h.get(e);if(t)return Object.keys(n).forEach(function(e){t[e]=n[e]}),u(),!0}i=i||localStorage,a=a||864e3,s=s||1e3;var g,h={},S={name:t,app:e,tracker:n},b=o(y.storageListTS,S),E=o(y.storageList,S),T=null,k=null;return h.push=f,h.toArray=l,h.clean=d,h.remove=p,h.update=v,h.get=r(h,function(e){c();var n;return g.some(function(t){return e===t.id?(n=t,t):void 0}),n},!0),h}function a(){function e(e,n){return i.push({event:e,fn:n}),o}function n(e,n){return i=i.filter(function(t){return!(t.event===e&&t.fn===n)}),o}function t(t,r){function i(){n(t,i),r.apply(o,arguments)}return e(t,i),o}function r(e){var n=[].slice.call(arguments,1);return i.filter(function(n){return n.event===e}).forEach(function(e){e.fn.apply(o,n)}),o}var o={},i=[];return o.on=e,o.off=n,o.once=t,o.emit=r,o}function s(){function n(s){s=s||0,r&&clearTimeout(r),r=setTimeout(function(){if(r=null,t=[],Object.keys(localStorage).forEach(function(e){var n=e.match(/^h5t@storageList\/(\w+)\/(\w+)\/send$/);if(n){var r=n[1],o=n[2],s=a[[r,o]];s||(a[[r,o]]=s=i(r,o,"send"));var c=s.toArray();c.forEach(function(e){e.storageDict=[r,o].toString()}),t=t.concat(c)}}),!(t.length<=0)){t.sort(function(e,n){return e.tried===n.tried?n.birthday-e.birthday:e.tried-n.tried});var s=t.shift();if(a[s.storageDict].update(s.id,{tried:(s.tried||0)+1}),!s.data.accept)return void console.error("accept is undefined.");var c=e.createElement("img");c.onload=function(){a[s.storageDict].remove(s.id),delete o[s.id],n(1e3)},c.onerror=function(){delete o[s.id],n(6e4)};var u,f=s.data.accept.match(/^([^?]+)(?:\?(.*))?$/),l=f[1],d=f[2];u="path"===s.data.acceptStyle?l+(/\/$/.test(l)?"":"/")+s.data.query.replace(/[&=]/g,"/")+(d?"?"+d:""):l+"?"+s.data.query+(d?"&"+d:""),c.src=u,o[s.id]=c}},s)}var t,r,o={},a={};return o.scan=n,o}function c(e,n){function t(e){return u.clean(),u.push(e)}function r(e){var n=[];return Object.keys(e).forEach(function(t){null!==e[t]&&n.push(encodeURIComponent(t)+"="+encodeURIComponent(e[t]))}),n.join("&")}function o(e,n,t){if(!n)return void console.error("accept is undefined.");c.clean();var o=c.push({accept:n,acceptStyle:t,query:r(e)});return h.scan(),o}var s=a(),c=i(e,n,"send"),u=i(e,n,"log");return h.scan(),s.log=t,s.send=o,s}function u(e,n,r){return function(o,i){if("string"==typeof o||"number"==typeof o)n(r?t(o):o,i);else if("object"==typeof o)if(o instanceof Array)o.forEach(function(e,t){n(t,e)});else for(var a in o)n(r?t(a):a,o[a]);return e}}function f(e,n){function t(e){if(!f)return void v.push({name:"send",data:e});if(!p.accept)return void console.error("options.accept is undefined.");var n={id:m()};if(p.data&&Object.keys(p.data).forEach(function(e){n[e]=p.data[e]}),Object.keys(d).forEach(function(e){n[e]=d[e]}),Object.keys(e).forEach(function(t){n[t]=e[t]}),p.event){var t=p.event.send;"function"==typeof t&&t.call(s,n)}s.emit("send",n),l.send(n,p.accept,p.acceptStyle)}function o(e){if(!f)return void v.push({name:"log",data:e});if("string"==typeof e&&(e={message:e,level:"debug"}),!e.level)return void console.error("log level is undefined.");var n={};if(Object.keys(e).forEach(function(t){n[t]=e[t]}),p.event){var t=p.event.log;"function"==typeof t&&t.call(s,n)}s.emit("log",n),l.log(n)}function i(e){return f?void console.error("Cannot duplicate create tracker."):e?(f=!0,p=e,v.forEach(function(e){s[e.name](e.data)}),void(v=null)):void console.error('Parameter "opts" cannot be empty.')}var s=a();s.name=n;var f,l=c(e,n),d={};s.set=u(s,function(e,n){d[e]=n},!0),s.get=r(s,function(e){return d[e]},!0);var p,v=[];return s.send=t,s.log=o,["debug","info","warn","error","fatal"].forEach(function(e){s[e]=function(n){o({level:e,message:n})}}),s.create=i,s}function l(n){function t(){sessionStorage[y.sessionId]&&s.emit("destroySession");var e=Date.now();sessionStorage[y.sessionId]=m(),sessionStorage[y.sessionBirthday]=e,sessionStorage[y.sessionLiveTime]=e,s.emit("createSession")}function o(){sessionStorage[y.sessionId]&&(delete sessionStorage[y.sessionId],delete sessionStorage[y.sessionBirthday],delete sessionStorage[y.sessionLiveTime],s.emit("destroySession"))}function i(){if(!u){var e=Date.now();u=setTimeout(function(){Date.now()-sessionStorage[y.liveTime]>=1e3*n?t():sessionStorage[y.sessionLiveTime]=e,u=null},1e3)}}n=n||30;var s=a(),c={id:y.sessionId,birthday:y.sessionBirthday,liveTime:y.sessionLiveTime};s.get=r(s,function(e){return sessionStorage[c[e]]},!0),s.createSession=t,s.destroySession=o,sessionStorage[y.sessionId]||t();var u;return["keydown","input","keyup","click","contextmenu","mousemove","touchstart","touchend","touchmove"].forEach(function(n){e.addEventListener(n,i,!1)}),s}function d(e){function n(n){if("string"!=typeof n)return void console.error('Parameter "line" is not a string type.');var r=n.match(/^(?:([\w$_]+)\.)?(\w+)$/);if(!r)return void console.error('Parameter "line" is invalid format.');var o=r[1],i=r[2],a=[].slice.call(arguments,1);if(o){var s=S[o];if(s||(s=S[o]=f(e,o),s.set({user:t})),"function"==typeof s[i])return s[i].apply(s,a);console.error('Tracker method "%s" is invalid.',i)}else{if("function"==typeof b[i])return b[i].apply(b,a);console.error('App method "%s" is invalid.',i)}}var t=localStorage[y.userId];t||(t=localStorage[y.userId]=m());var r=f("main");r.createEmitter=a,r.createStorage=c,r.createStorageList=i,r.createTracker=f,r.newGuid=m,r.storageKeys=y,r.createApp=d,r.createSessionManager=l,r.createStorageSender=s,r.set({user:t}),S[r.name]=r;var o=l();return o.on("createSession",function(){r.emit("createSession")}),o.on("destroySession",function(){r.emit("destroySession")}),r.cmd=n,r}var p=n.h5tObjectName||"h5t",v=n[p];if(!v||!v.defined){var g={},m=function(){var e=parseInt(36*Math.random());return function(){return Date.now().toString(36)+(e++%36).toString(36)+Math.random().toString(36).slice(2,4)}}(),y=function(){var e="h5t@";return{userId:e+"global/userId",scanTime:e+"global/scanTime",sessionId:e+"global/sessionId",sessionBirthday:e+"global/sessionBirthday",sessionLiveTime:e+"global/sessionLiveTime",storageList:e+"storageList/#{app}/#{tracker}/#{name}",storageListTS:e+"storageList/#{app}/#{tracker}/#{name}/ts"}}(),h=s(),S={},b=d(p),E=function(){b.cmd.apply(b,arguments)};if(E.app=b,E.defined=!0,v){var T=[].concat(v.p||[],v.q||[]);v.p=v.q=null,E.p=E.q={push:function(e){E.apply(E,e)}},T.forEach(function(e){E.apply(E,e)})}n[p]=E}}(document,window);