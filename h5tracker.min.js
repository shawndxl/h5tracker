!function(e,n){function t(e){if(!e||"string"!=typeof e)return e;var n=y[e];return n?n:(n=e.indexOf("-")<0&&e.indexOf("_")<0?e:e.replace(/[-_]+([a-z])/gi,function(e,n){return n.toUpperCase()}),y[e]=n,n)}function i(e,n,i){var r=function(o,s){var a,c;if("function"==typeof o)return c=o["-jsets-params"],c||(c=[],String(o).replace(/\(\s*([^()]+?)\s*\)/,function(e,n){c=n.split(/\s*,\s*/)}),o["-jsets-params"]=c),r(c,o);if("string"==typeof o||"number"==typeof o)return o=i?t(o):o,"function"==typeof s?(s.call(e,n(o)),e):n(o);if("object"==typeof o){if(o instanceof Array)return"function"==typeof s?(a=[],o.forEach(function(e){a.push(n(i?t(e):e))}),s.apply(e,a),e):(a={},o.forEach(function(e){a[e]=n(i?t(e):e)}),a);var u;if("function"==typeof s){a=[];for(u in o)a.push(n(i?t(u):u)||o[u]);return e}a={};for(u in o)a[u]=n(i?t(u):u)||o[u];return a}};return r}function r(e,n){return e.replace(/#\{(.*?)\}/g,function(e,t){return n&&t in n?n[t]:""})}function o(e,n,t,o,s,a){function c(){if(o[b]!==q&&(h=null),!h)try{h=JSON.parse(o[E]||"[]"),q=o[b]}catch(e){h=[]}}function u(){o[b]=m(),o[E]=JSON.stringify(h)}function f(e){c();for(var n=m(),t=Date.now();h.length>=a;)h.shift();return h.push({id:n,birthday:t,expires:s,tried:0,data:e}),u(),n}function l(){return c(),h.slice()}function d(){c();var e=0,n=Date.now();if(null!==I){if(!(n>I))return e;I=null}return h=h.filter(function(t){var i=t.birthday+1e3*t.expires;return n>i?(e++,!1):(I=null!==I?Math.min(I,i):i,!0)}),u(),e}function p(e){c(),h=h.filter(function(n){return e===n.id?(n.birthday+1e3*n.expires===I&&(I=null),!1):!0}),u()}function v(e,n){var t=y.get(e);if(t)return Object.keys(n).forEach(function(e){t[e]=n[e]}),u(),!0}o=o||localStorage,s=s||864e3,a=a||1e3;var h,y={},S={name:t,app:e,tracker:n},b=r(g.storageListTS,S),E=r(g.storageList,S),q=null,I=null;return y.push=f,y.toArray=l,y.clean=d,y.remove=p,y.update=v,y.get=i(y,function(e){c();var n;return h.some(function(t){return e===t.id?(n=t,t):void 0}),n},!0),y}function s(){function e(e,n){return o.push({event:e,fn:n}),r}function n(e,n){return o=o.filter(function(t){return!(t.event===e&&t.fn===n)}),r}function t(t,i){function o(){n(t,o),i.apply(r,arguments)}return e(t,o),r}function i(e){var n=[].slice.call(arguments,1);return o.filter(function(n){return n.event===e}).forEach(function(e){e.fn.apply(r,n)}),r}var r={},o=[];return r.on=e,r.off=n,r.once=t,r.emit=i,r}function a(){function n(a){a=a||0,i&&clearTimeout(i),i=setTimeout(function(){if(i=null,t=[],Object.keys(localStorage).forEach(function(e){var n=e.match(/^h5t@storageList\/(\w+)\/(\w+)\/send$/);if(n){var i=n[1],r=n[2],a=s[[i,r]];a||(s[[i,r]]=a=o(i,r,"send"));var c=a.toArray();c.forEach(function(e){e.storageDict=[i,r].toString()}),t=t.concat(c)}}),!(t.length<=0)){t.sort(function(e,n){return e.tried===n.tried?n.birthday-e.birthday:e.tried-n.tried});var a=t.shift();if(s[a.storageDict].update(a.id,{tried:(a.tried||0)+1}),!a.data.accept)return void console.error("accept is undefined.");var c=e.createElement("img");c.onload=function(){s[a.storageDict].remove(a.id),delete r[a.id],n(1e3)},c.onerror=function(){delete r[a.id],n(3e5)};var u,f=a.data.accept.match(/^([^?]+)(?:\?(.*))?$/),l=f[1],d=f[2];u="path"===a.data.acceptStyle?l+(/\/$/.test(l)?"":"/")+a.data.query.replace(/[&=]/g,"/")+(d?"?"+d:""):l+"?"+a.data.query+(d?"&"+d:""),c.src=u,r[a.id]=c}},a)}var t,i,r={},s={};return r.scan=n,r}function c(e){var n=[];return Object.keys(e).forEach(function(t){null!==e[t]&&void 0!==e[t]&&n.push(encodeURIComponent(t)+"="+encodeURIComponent(e[t]))}),n.join("&")}function u(e,n){function t(e){return u.clean(),u.push(e)}function i(e,n,t){a.clean();var i=a.push({accept:n,acceptStyle:t,query:c(e)});return S.scan(),i}var r=s(),a=o(e,n,"send"),u=o(e,n,"log");return S.scan(),r.log=t,r.send=i,r}function f(e,n,i){return function(r,o){if("string"==typeof r||"number"==typeof r)n(i?t(r):r,o);else if("object"==typeof r)if(r instanceof Array)r.forEach(function(e,t){n(t,e)});else for(var s in r)n(i?t(s):s,r[s]);return e}}function l(n){function t(){c[g.sessionId]&&u.emit("destroySession");var e=Date.now();c[g.sessionId]=m(),null===c[g.sessionSeq]||isNaN(c[g.sessionSeq])?c[g.sessionSeq]=0:c[g.sessionSeq]=parseInt(c[g.sessionSeq])+1,c[g.sessionBirthday]=e,c[g.sessionLiveTime]=e,u.emit("createSession")}function r(){c[g.sessionId]&&(delete c[g.sessionId],delete c[g.sessionBirthday],delete c[g.sessionLiveTime],u.emit("destroySession"))}function o(){c[g.sessionId]||t()}function a(e){var i=Date.now();i-c[g.sessionLiveTime]>=1e3*n?t():setTimeout(function(){c[g.sessionLiveTime]=i})}var c=sessionStorage;n=n||30;var u=s(),f={sid:g.sessionId,seq:g.sessionSeq,birthday:g.sessionBirthday,liveTime:g.sessionLiveTime};return u.get=i(u,function(e){return"undefined"==typeof c[g.sessionId]&&(console.info("sessionManager get createSession"),t()),c[f[e]]},!0),u.createSession=t,u.destroySession=r,u.init=o,["keydown","input","keyup","click","contextmenu","mousemove","touchstart","touchend","touchmove"].forEach(function(n){e.addEventListener(n,a,!1)}),u}function d(e,n){function t(e){if(!l)return void h.push({name:"send",data:e});var n={rid:m()};v.data&&Object.keys(v.data).forEach(function(e){n[e]=v.data[e]}),Object.keys(p).forEach(function(e){n[e]=p[e]}),"string"==typeof e&&(e={ht:e}),Object.keys(e).forEach(function(t){n[t]=e[t]}),a("send",n),d.send(n,v.accept,v.acceptStyle)}function r(e){if("string"==typeof e&&(e={message:e,level:"debug"}),!l)return void h.push({name:"log",data:e});var n={};Object.keys(e).forEach(function(t){n[t]=e[t]}),a("log",n),d.log(n)}function o(e){l=!0,v=e,h.forEach(function(e){c[e.name](e.data)}),h=null}function a(e,n){if(v&&v.event){var t=v.event[e];"function"==typeof t&&t.call(c,n)}c.emit(e,n)}var c=s();c.name=n;var l,d=u(e,n),p={};c.set=f(c,function(e,n){p[e]=n},!0),c.get=i(c,function(e){return p[e]},!0);var v,h=[];return c.send=t,c.log=r,["debug","info","warn","error","fatal"].forEach(function(e){c[e]=function(n){r({level:e,message:n})}}),c.create=o,c.emitEvent=a,c}function p(e,n){function t(){s.init();var e=a;a=null,e.forEach(function(e){i.apply(o,e)})}function i(n){var t,i=n.match(/^(?:([\w$_]+)\.)?(\w+)$/),c=i[1],u=i[2],f=[].slice.call(arguments,1);if(c?(t=b[c],t||(t=b[c]=d(e,c))):t=o,"function"==typeof t[u]){if("send"===u||"log"===u){if(a)return void a.push(arguments);t.set({uid:r,sid:s.get("sid"),seq:s.get("seq"),time:(Date.now()-s.get("birthday")).toString(36)})}return t[u].apply(t,f)}console.error('Tracker method "%s" is invalid.',u)}e=e||"h5t";var r=localStorage[g.userId];r||(r=localStorage[g.userId]=m());var o=d(e,e);b[e]=o;var s=l(n);s.on("createSession",function(){Object.keys(b).forEach(function(e){b[e].emitEvent("createSession")})}),s.on("destroySession",function(){Object.keys(b).forEach(function(e){b[e].emitEvent("destroySession")})});var a=[];return o.init=t,o.cmd=i,o}var v=n.h5tObjectName||"h5t",h=n[v];if(!h||!h.defined){n.localStorage||(n.localStorage={}),n.sessionStorage||(n.sessionStorage={});var y={},g=function(){var e="h5t@";return{userId:e+"global/userId",scanTime:e+"global/scanTime",sessionId:e+"global/sessionId",sessionSeq:e+"global/sessionSeq",sessionBirthday:e+"global/sessionBirthday",sessionLiveTime:e+"global/sessionLiveTime",storageList:e+"storageList/#{app}/#{tracker}/#{name}",storageListTS:e+"storageList/#{app}/#{tracker}/#{name}/ts"}}(),m=function(){var e=parseInt(36*Math.random());return function(){return Date.now().toString(36)+(e++%36).toString(36)+Math.random().toString(36).slice(2,4)}}(),S=a(),b={},E=p(v),q=function(){E.cmd.apply(E,arguments)};if(q.app=E,q.defined=!0,h){var I=[].concat(h.p||[],h.q||[]);h.p=h.q=null,q.p=q.q={push:function(e){q.apply(q,e)}},I.forEach(function(e){q.apply(q,e)})}n[v]=q,E.init()}}(document,window);